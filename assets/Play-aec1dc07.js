import{n as P,d as N,j as B,f as v,p as C,c as _,b as i,a as T,w as U,l as M,q as E,g as L,r as V,o as y,e as j}from"./index-2a250b2a.js";import{g as w,r as b,l as z,a as A}from"./index.esm2017-f8c39613.js";let h;async function D(){return new Promise((l,e)=>{if(h!=null)l(h);else{const d=w(),g=b(d,"");let a=new Map,m=0;z(g).then(o=>{o.prefixes.forEach(t=>{console.log(t)}),o.items.forEach(t=>{console.log(t);const p={id:m,name:t.name,url:t.fullPath,playCount:0,deleteFlag:!1};a.set(m,p),m++}),h=a,l(h)}).catch(o=>{console.log("Error: ListAll",o),e(new Error("Get MovieList Error"))})}})}const R=P({id:"movieInfo",state:()=>({movieInfoList:new Map,isLoading:!0}),getters:{getById:r=>l=>r.movieInfoList.get(l),isMovieListEmpty:r=>(console.log("getter:isMovieListEmpty",r.movieInfoList.size),r.movieInfoList.size==0)},actions:{async prepareMovieInfoList(){const r=await D();return this.movieInfoList=r,this.isLoading=!1,new Promise((e,d)=>{e(!0)})}}}),q={ref:"root"},O=i("h1",null," 動画再生画面 ",-1),F={id:"breadcrumbs"},G=i("li",null," 動画再生画面 ",-1),H={id:"movie"},$=["src"],J={key:0},K={key:1},X=N({__name:"Play",setup(r){const l=B(HTMLVideoElement),e=R(),d=v(()=>e.movieInfoList),g=v(()=>e.isMovieListEmpty);v(()=>e.isLoading),v(()=>e.getById(1));let a=[];e.prepareMovieInfoList().then(n=>{const c=d.value;console.log("Prepareの方",c.size);for(const[s,f]of c)a.push(f.name),console.log("D",s,f);a=S(a),I()}).catch(n=>{console.log("error in prepare ",n)});const m="gs://movie-storage-52646.appspot.com/";let o=0,t=!1;const p=C(""),k=w();function S(n){const c=[];for(;n.length>0;){const s=Math.floor(Math.random()*n.length);c.push(n[s]),n.splice(s,1)}return c}function I(){var n=a[o];console.log("index="+o);const c=b(k,m+n);A(c).then(s=>{if(p.value=s,t=!0,console.log(s),console.log("getPlayer",l),l){var f=document.querySelector("#player");f&&(f.load(),fetch(p.value).then(u=>u.blob()).then(u=>{if(f)return f.srcObject=u,f.play()}).then(u=>{console.log("video playback started")}).catch(u=>{console.log("video playback failed",u)}))}}),o++,o>=a.length&&(o=0)}function x(){console.log("onEnded"),t=!1,I()}return(n,c)=>{const s=V("RouterLink");return y(),_("div",q,[O,i("nav",F,[i("ul",null,[i("li",null,[T(s,{to:{name:"AppTop"}},{default:U(()=>[j(" TOP ")]),_:1})]),G])]),M(i("section",null,[i("div",H,[i("video",{id:"player",src:p.value,onEnded:x,autoplay:"",muted:"",playsinline:"",controls:""},null,40,$)])],512),[[E,L(t)]]),M(i("section",null,[L(g)?(y(),_("p",J,"動画が存在しません")):(y(),_("p",K,"読み込み中・・・"))],512),[[E,!L(t)]])],512)}}});export{X as default};
