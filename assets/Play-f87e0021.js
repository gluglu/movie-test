import{e as x,f as S,g as u,h as w,r as E,o as p,c as d,b as o,a as N,w as B,d as P,i as v,v as g,u as h}from"./index-a8726147.js";import{g as R,r as T,a as U}from"./index.esm2017-de2ee40a.js";import{u as V}from"./movieInfo-def4d4ed.js";const C={ref:"root"},D=o("h1",null," 動画再生 ",-1),O={id:"breadcrumbs"},j=o("li",null," 動画再生 ",-1),q=o("h2",null,"全画面モードで再生してください",-1),z={id:"movie"},A=["src"],H={key:0},$={key:1},Q=x({__name:"Play",setup(F){const m=S(HTMLVideoElement),a=V(),y=u(()=>a.movieInfoList),b=u(()=>a.isMovieListEmpty);u(()=>a.isLoading),u(()=>a.getById(1));let i=[];a.prepareMovieInfoList().then(e=>{const n=y.value;console.log("Prepareの方",n.size);for(const[t,s]of n)i.push(s.name),console.log("D",t,s);i=I(i),_()}).catch(e=>{console.log("error in prepare ",e)});const k="gs://movie-storage-52646.appspot.com/";let r=0,c=!1;const f=w(""),L=R();function I(e){const n=[];for(;e.length>0;){const t=Math.floor(Math.random()*e.length);n.push(e[t]),e.splice(t,1)}return n}function _(){var e=i[r];console.log("index="+r);const n=T(L,k+e);U(n).then(t=>{if(f.value=t,c=!0,console.log(t),console.log("getPlayer",m),m){var s=document.querySelector("#player");s&&(s.load(),fetch(f.value).then(l=>l.blob()).then(l=>{if(s)return s.srcObject=l,s.play()}).then(l=>{console.log("video playback started")}).catch(l=>{console.log("video playback failed",l)}))}}),r++,r>=i.length&&(r=0)}function M(){console.log("onEnded"),c=!1,_()}return(e,n)=>{const t=E("RouterLink");return p(),d("div",C,[D,o("nav",O,[o("ul",null,[o("li",null,[N(t,{to:{name:"AppTop"}},{default:B(()=>[P(" TOP ")]),_:1})]),j])]),v(o("section",null,[q,o("div",z,[o("video",{id:"player",src:f.value,onEnded:M,autoplay:"",muted:"",playsinline:"",controls:""},null,40,A)])],512),[[g,h(c)]]),v(o("section",null,[h(b)?(p(),d("p",H,"動画が存在しません")):(p(),d("p",$,"読み込み中・・・"))],512),[[g,!h(c)]])],512)}}});export{Q as default};
