import{e as S,f as E,g as f,h as V,r as N,o as h,c as m,b as o,a as B,w as D,d as P,i as y,v as b,u as v}from"./index-aea4c5b1.js";import{g as R,r as T,a as U}from"./index.esm2017-0720249d.js";import{u as C}from"./movieInfo-d2007fb9.js";const O={ref:"root"},j=o("h1",null," 動画再生 ",-1),q={id:"breadcrumbs"},z=o("li",null," 動画再生 ",-1),A=o("h2",null,"全画面モードで再生してください",-1),F={id:"movie"},H=["src"],$={key:0},G={key:1},X=S({__name:"Play",setup(J){const _=E(HTMLVideoElement),i=C(),k=f(()=>i.movieInfoList),I=f(()=>i.isMovieListEmpty);f(()=>i.isLoading),f(()=>i.getById(1));let r=[];i.prepareMovieInfoList().then(e=>{const n=k.value;console.log("Prepareの方",n.size);for(const[t,d]of n)r.push(d.name),console.log("D",t,d);r=w(r),g()}).catch(e=>{console.log("error in prepare ",e)});const L="gs://movie-storage-52646.appspot.com/";let s=0,c=!1;const p=V(""),M=R();function w(e){const n=[];for(;e.length>0;){const t=Math.floor(Math.random()*e.length);n.push(e[t]),e.splice(t,1)}return n}function g(){var e=!1;do{var n=r[s],t=L+"Folder1/"+n;console.log("fileIndex:",s," downloadUrl:",t);const d=T(M,t);U(d).then(u=>{if(p.value=u,c=!0,console.log(u),console.log("getPlayer",_),_){var l=document.querySelector("#player");l&&(l.load(),fetch(p.value).then(a=>a.blob()).then(a=>{if(l)return console.log("video",l),l.srcObject=a,e=!0,l.play()}).then(a=>{console.log("video playback started")}).catch(a=>{console.log("video playback failed",a)}))}}).catch(u=>{console.log("getDownload failed:",u)}),s++,s>=r.length&&(s=0),console.log("isValidMovie:",e," fileIndex:",s)}while(e)}function x(){console.log("onEnded"),c=!1,g()}return(e,n)=>{const t=N("RouterLink");return h(),m("div",O,[j,o("nav",q,[o("ul",null,[o("li",null,[B(t,{to:{name:"AppTop"}},{default:D(()=>[P(" TOP ")]),_:1})]),z])]),y(o("section",null,[A,o("div",F,[o("video",{id:"player",src:p.value,onEnded:x,autoplay:"",muted:"",playsinline:"",controls:""},null,40,H)])],512),[[b,v(c)]]),y(o("section",null,[v(I)?(h(),m("p",$,"動画が存在しません")):(h(),m("p",G,"読み込み中・・・"))],512),[[b,!v(c)]])],512)}}});export{X as default};
